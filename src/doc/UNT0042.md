# UNT0042 Mesh array property accessed in loop

Accessing array properties like `vertices`, `normals`, `tangents`, `uv`, `colors`, etc. on `Mesh` inside a loop causes a new array allocation on each access. This can significantly impact performance, especially in frequently called methods like `Update()`.

This analyzer detects properties on `Mesh` that return arrays of `Vector2`, `Vector3`, `Vector4`, `Color`, or `Color32`.

## Examples of patterns that are flagged by this analyzer

```csharp
using UnityEngine;

class Example : MonoBehaviour
{
    void Update()
    {
        Mesh mesh = GetComponent<MeshFilter>().mesh;

        // Bad: mesh.vertices allocates a new array on every iteration
        for (int i = 0; i < mesh.vertices.Length; i++)
        {
            // ...
        }

        // Bad: mesh.vertices and mesh.normals allocate new arrays on every iteration
        for (int i = 0; i < mesh.vertexCount; i++)
        {
            mesh.vertices[i] += mesh.normals[i] * Time.deltaTime;
        }
    }
}
```

## Solution

Cache the array property in a local variable before the loop:

```csharp
using UnityEngine;

class Example : MonoBehaviour
{
    void Update()
    {
        Mesh mesh = GetComponent<MeshFilter>().mesh;

        // Good: cache the array before the loop
        Vector3[] vertices = mesh.vertices;
        for (int i = 0; i < vertices.Length; i++)
        {
            // ...
        }

        // Good: cache arrays before the loop, assign back after modifications
        Vector3[] verts = mesh.vertices;
        Vector3[] normals = mesh.normals;
        for (int i = 0; i < verts.Length; i++)
        {
            verts[i] += normals[i] * Time.deltaTime;
        }
        mesh.vertices = verts;
    }
}
```

## Detected Mesh Properties

This analyzer flags `Mesh` properties that return arrays of these element types:

- `Vector2[]` (e.g., `uv`, `uv2`, `uv3`, `uv4`, `uv5`, `uv6`, `uv7`, `uv8`)
- `Vector3[]` (e.g., `vertices`, `normals`)
- `Vector4[]` (e.g., `tangents`)
- `Color[]` (e.g., `colors`)
- `Color32[]` (e.g., `colors32`)

## Non-allocating Alternatives

Use `vertexCount` instead of `vertices.Length` when you only need the count:

```csharp
// Good: vertexCount doesn't allocate
for (int i = 0; i < mesh.vertexCount; i++)
{
    // ...
}
```

## See Also

- [Unity Mesh API Reference](https://docs.unity3d.com/ScriptReference/Mesh.html)
