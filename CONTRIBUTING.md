# Contributing

This project has adopted the [Microsoft Open Source Code of
Conduct](https://opensource.microsoft.com/codeofconduct/).
For more information see the [Code of Conduct
FAQ](https://opensource.microsoft.com/codeofconduct/faq/) or
contact [opencode@microsoft.com](mailto:opencode@microsoft.com)
with any additional questions or comments.

# Prerequisites

This project is using the `DiagnosticSuppressor` API to conditionally suppress reported compiler/analyzer diagnostics. This API is available starting with Visual Studio 2019 16.3.

For building and testing, you'll need .NET SDK. We recommend using SDK Version 3.0.100 or later.

# Building and testing

Everything can be compiled and deployed using the command line:

Compiling the main project only:
`dotnet build .\src\Microsoft.Unity.Analyzers`

Unit-Testing:
`dotnet test .\src\Microsoft.Unity.Analyzers.Tests`

Compiling all projects and deploying analyzers/suppressors as a VSIX extension into the Visual Studio Experimental Instance:
`msbuild .\src\Microsoft.Unity.Analyzers.sln`

The easiest way to compile and debug interactively is to use Visual Studio 2019 :
- Load the `Microsoft.Unity.Analyzers.sln` solution.
- Set `Microsoft.Unity.Analyzers.Vsix` as your startup project.
- Hit play (Current Instance) to start debugging an experimental instance of Visual Studio 2019.
- Load any Unity project in the VS experimental instance then put breakpoints in the Analyzer project using the VS main instance.

# Handling duplicate diagnostics 

Starting with Visual Studio Tools for Unity 4.3.2.0 (or 2.3.2.0 on MacOS), we ship and automatically include this set of analyzers/suppressors in all projects generated by Unity (using `<Analyzer Include="..." />` directive).

The downside of this, when trying to debug your own solution is to find yourself with duplicated diagnostics because Visual Studio will load both:
- the project-local analyzer that we release and include automatically, through the `<Analyzer Include="..." />` directive. 
- the VSIX extension you deployed, that will apply analyzers/suppressors to all projects in the IDE.

So to disable the project-local analyzer, and keeping a workflow compatible with Unity re-generating project files on all asset changes, you can add the following script in an `Editor` folder of your Unity project to disable all local analyzers loaded with `<Analyzer Include="..." />` directive.

```csharp
using UnityEditor;

public class DisableLocalAnalyzersPostProcessor : AssetPostprocessor
{
	public static string OnGeneratedCSProject(string path, string content)
	{
		return content.Replace("<Analyzer Include=", "<Analyzer Condition=\"false\" Include=");
	}
}
```

# Create a new analyzer 

To easily create a new analyzer, you can use the following command:

`dotnet run --project .\src\new-analyzer`

This will automatically create source files for the analyzer, associated tests and add resource entries.

## Bug reports

If you have a bug report, please file an issue. 
If you can send a pull request with a repro of the bug in the form of a unit test, please do submit that PR
and link to it from the Issue you file.

## Pull Requests

We love to get pull requests. If you have a bug fix to offer or a new analyzer, please send us a pull request.

Every new feature or bug fix should be accompanied by unit tests to cover your change and proper documentation.
